<!DOCTYPE html>

<html>
    <head>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;1,200&display=swap" rel="stylesheet">
        <link href="https://rsms.me/inter/inter.css" rel="stylesheet">
        <link rel="stylesheet" href="css-main/cssmainwebsite.css">
        <link rel="stylesheet" href="css-main/CT_LT-Main.css">
        <link rel="stylesheet" href="css-main/CT-Reservation-details.css">
        <link rel="icon" href="images/icon.png">
        <title>tinkerlab.</title>
    </head>

    <body>
         <div class="header">
            <img class="imglogo" src="images/tinkerlablogo.png">
        </div>
        <div class="taskbar">
          <div class="btndivider">
            <a href="/LT-homepage">
                <button class="btndesign" id="homebtn">Home</button>
            </a>
          </div>
          <div class="btndivider">
              <a href="/LAndrew">
              <button class="btndesign" id="reservationbtn">Reservation</button>
            </a>
          </div>
          <div class="btndivider">
              <a href="/LT-View-Edit">
              <button class="btndesign" id="vieweditbtn">View/Edit</button>
              </a>
          </div>
          <div class="btndivider">
            <a href="/LT-Profile">
              <button class="btndesign" id="profilebtn">Profile</button>
            </a>
        </div>
            
            <div class="searchdivider">
                <div class="searchfield">
                    <button class="searchbutton"><img src="images/searchglass.png" class="imgbtn"></button>
                    
                    <input class="searchinput" type="text" placeholder="Search...">
                </div>
            </div>
        </div>

        <div class = "sort-container">
          <div class = "lab-button">
              <p class = "sort-text">COMPUTER LAB:</p>
              <div class="custom-select-wrapper">
                  <select id="lab-dropdown" class="lab-dropdown">
                    <option value="AG101">AG101</option>
                    <option value="GK101">GK101</option>
                    <option value="VL101">VL101</option>
                </select>
              </div>
          </div>

          <div class = "time-button">
              <p class = "sort-text">TIME:</p>
              <div class="custom-select-wrapper">
                  <select id="time-dropdown" class="time-dropdown" name="time">
                    <option class="choices" value="7:30AM-8:00AM">7:30AM - 8:00AM</option>
                    <option class="choices" value="8:00AM-8:30AM">8:00AM - 8:30AM</option>
                    <option class="choices" value="8:30AM-9:00AM">8:30AM - 9:00AM</option>
                    <option class="choices" value="9:00AM-9:30AM">9:00AM - 9:30AM</option>
                    <option class="choices" value="9:30AM-10:00AM">9:30AM - 10:00AM</option>
                    <option class="choices" value="10:00AM-10:30AM">10:00AM - 10:30AM</option>
                    <option class="choices" value="10:30AM-11:00AM">10:30AM - 11:00AM</option>
                    <option class="choices" value="11:00AM-11:30AM">11:00AM - 11:30AM</option>
                    <option class="choices" value="11:30AM-12:00PM">11:30AM - 12:00PM</option>
                    <option class="choices" value="12:00PM-12:30PM">12:00PM - 12:30PM</option>
                    <option class="choices" value="">----</option>
                </select>
              </div>
          </div>

          <script src="js-main/CT-Reservation_DateRestrict.js"></script>
          <div class = "date-button">
              <p class = "sort-text">DATE:</p>
            <input type="date" class="date-input" id="dateInput" name="date">
            <!-- Hidden input to store selected time -->
            <input type="hidden" id="selectedTime" name="time">
    </form>
          </div>
      </div>

      <div class="tablediv">
          <table>
            <thead>
                <tr>
                <th>Computer Lab</th>
                <th>Time</th>
                <th>Date</th>
                <th>Available Seats</th>
                <th> </th>
                </tr>
            </thead>
           <tbody>
             {{#each data}}
        <tr>
            <td>AG101</td> <!-- This is static; consider changing it dynamically if needed -->
            <td>{{this.time}}</td>
            <td>{{this.date}}</td>
            <td>{{this.availableSeats}}</td>
            <td>
                <button class="go-button"><a href="/LAndrew">Go</a></button>
            </td>
        </tr>
        {{/each}}
        </tbody>
          </table>
      </div>
 <div class="button-container">
    <button class="purple-button" id="search-button">Search</button>
</div> 

       <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchButton = document.getElementById('search-button');
            const labDropdown = document.getElementById('lab-dropdown');
            const dateInput = document.getElementById('dateInput');
            const timeDropdown = document.getElementById('time-dropdown');

            searchButton.addEventListener('click', async function() {
                const selectedLab = labDropdown.value;
                const dateofreservation = dateInput.value;
                const timeofreservation = timeDropdown.value;

                let lab, dblab;

                switch (selectedLab) {
                    case "GK101":
                        lab = "GK101";
                        dblab = "Goks";
                        break;
                    case "AG101":
                        lab = "AG101";
                        dblab = "Andrews";
                        break;
                    case "VL101":
                        lab = "VL101";
                        dblab = "Velascos";
                        break;
                    default:
                        alert('Please select a valid lab.');
                        return;
                }

                const searchData = {
                    lab,
                    dblab,
                    dateofreservation,
                    timeofreservation
                };

                console.log("Search Data:", searchData);

                try {
                    const response = await fetch('/LgetSearch', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(searchData)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        // Redirect based on the response URL
                        window.location.href = result.redirectUrl;
                    } else {
                        const errorMessage = await response.text();
                        alert('An error occurred: ' + errorMessage);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again later.');
                }
            });
        });
</script>

    </body>
    <footer>
      <div class="footer-container">
          <div class="footer-column-1">
              <img class="footer-logo" src="images/tinkerlablogo.png">
              <p><span class = "tagline">Reserve in a Blink, then Explore and Think!</span></p>
          </div>
          <div class="footer-column-2">
              <h3>About</h3>
              <p class = "footer-about">an intuitive platform that allows students to easily<br> 
                  reserve, check availability, and manage their computer<br> 
                  lab seats, ensuring hassle-free access for projects,<br>studying, and creative work.</p>
          </div>
          <div class="footer-column-3">
              <h3>Contact</h3>
              <div class="contact-info">
                  <img class="email-logo" src="images/email-logo.png">
                  <a class="dlsu-email" href="mailto:charlemagne_craw@dlsu.edu.ph">charlemagne_craw@dlsu.edu.ph</a>
              </div>
              <div class="contact-info">
                  <img class="email-logo" src="images/email-logo.png">
                  <a class="dlsu-email" href="mailto:rafael_debelen@dlsu.edu.ph">rafael_debelen@dlsu.edu.ph</a>
              </div>
              <div class="contact-info">
                  <img class="email-logo" src="images/email-logo.png">
                  <a class="dlsu-email" href="mailto:monica_santiago@dlsu.edu.ph">monica_santiago@dlsu.edu.ph</a>
              </div>
              <div class="contact-info">
                  <img class="email-logo" src="images/email-logo.png">
                  <a class="dlsu-email" href="mailto:john_fredrick_tario@dlsu.edu.ph">john_fredrick_tario@dlsu.edu.ph</a>
              </div>
          </div>
      </div>
  </footer>
</html>
